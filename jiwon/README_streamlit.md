# 🐄 스마트팜 착유량 예측 시스템

## 📋 개요
스택킹 앙상블 모델을 사용한 스마트팜 착유량 예측 웹 애플리케이션입니다.

## 🚀 실행 방법

### 1. 필요한 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. 스트림릿 앱 실행
```bash
cd jiwon
streamlit run streamlit_app.py
```

### 3. 브라우저에서 접속
```
http://localhost:8501
```

## 🎯 주요 기능

### 1. 농장별 예측
- **농장 선택**: 7개 농장 중 선택
- **예측 기간**: 다음주 또는 다음달
- **예측 결과**: 
  - 예측 착유량 (L)
  - 농장별 통계 정보
  - 착유량 분포 차트

### 2. 개체별 예측
- **농장 선택**: 농장별로 개체 필터링
- **개체 선택**: 해당 농장의 개체 중 선택
- **개체 정보**: 
  - 평균 착유량, 총 착유 횟수
  - 평균 착유시간, 나이
  - 착유량 추이 차트
- **예측 결과**: 다음 착유 예측량

## 🤖 모델 정보

### 스택킹 앙상블 모델
- **기본 모델들**:
  - Random Forest (n_estimators=200)
  - XGBoost (n_estimators=200)
  - LightGBM (n_estimators=200)
- **메타 모델**: Ridge Regression
- **교차검증**: 5-fold CV

### 사용 피처 (14개)
1. 개체번호
2. 공기흐름_비율
3. P/F_ratio (유단백/유지방)
4. 개체별_착유일수
5. 측정일
6. 농장아이디
7. 착유시간
8. 착유회차
9. 착유시간대
10. 온도
11. 나이
12. 혈액흐름
13. 개체별_일별착유횟수
14. 유지방
15. 유단백

## 📊 데이터 전처리

### 1. 파생변수 생성
- 착유시간 (착유종료일시 - 착유시작일시)
- 착유시간대 (1-4 구간)
- P/F_ratio (유단백/유지방 비율)
- 공기흐름_비율
- 개체별_착유일수
- 개체별_일별착유횟수
- 나이 (개체번호에서 추출)

### 2. 이상치 제거
- IQR 기반 3σ 이상치 제거
- 제거된 행 수: 약 608개

### 3. 범주형 인코딩
- TargetEncoder 사용
- 농장아이디, 개체번호 인코딩

## 📈 모델 성능

### 최종 스택킹 모델 성능
- **RMSE**: 1.308
- **R²**: 0.869
- **MAE**: 0.964
- **MAPE**: 8.82%

### 교차검증 결과
- **CV R²**: 0.858 ± 0.005
- **과적합 정도**: 0.011

## 🛠️ 기술 스택

- **웹 프레임워크**: Streamlit
- **데이터 처리**: Pandas, NumPy
- **머신러닝**: Scikit-learn, XGBoost, LightGBM
- **시각화**: Plotly
- **범주형 인코딩**: Category Encoders

## 📁 파일 구조

```
jiwon/
├── streamlit_app.py          # 메인 스트림릿 앱
├── final_modeling.ipynb      # 모델링 노트북
├── preprocessing.ipynb       # 전처리 노트북
└── README_streamlit.md       # 이 파일
```

## 🔧 사용자 가이드

### 1. 농장별 예측 사용법
1. 사이드바에서 "농장별 예측" 선택
2. 농장 ID 선택 (20261, 20264, 20278, 20279, 20332, 20338, 21133)
3. 예측 기간 선택 (다음주/다음달)
4. "예측 실행" 버튼 클릭
5. 결과 확인 및 통계 정보 확인

### 2. 개체별 예측 사용법
1. 사이드바에서 "개체별 예측" 선택
2. 농장 ID 선택
3. 해당 농장의 개체 번호 선택
4. 개체 정보 및 착유량 추이 확인
5. "개체별 예측 실행" 버튼 클릭
6. 다음 착유 예측량 확인

## ⚠️ 주의사항

1. **데이터 경로**: CSV 파일 경로가 하드코딩되어 있으므로 필요시 수정
2. **모델 학습 시간**: 첫 실행 시 모델 학습에 시간이 소요될 수 있음
3. **메모리 사용량**: 대용량 데이터 처리 시 충분한 메모리 확보 필요
4. **API 키**: 날씨 API 기능 사용 시 별도 API 키 설정 필요

## 🔄 업데이트 내역

- **v1.0**: 기본 스택킹 모델 기반 예측 시스템
- **v1.1**: 농장별/개체별 예측 기능 분리
- **v1.2**: 시각화 및 통계 정보 추가 